<div><style type="text/css">.variant{display:none}.has-variant .variant{display:inline}.btn-upload.ld-ext-right{width:6em;transition:width .35s ease-in-out,padding-right .35s ease-in-out;flex:1 0 auto}.btn-upload.ld-ext-right.running{width:6.5em}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/upload",extend:{name:"@makeform/common"},i18n:{en:{"未命名的檔案":"unnamed file","上傳":"upload","上傳中":"uploading","尚未上傳任何檔案":"no file uploaded yet","檔案大小":"File Size","編輯時戳":"Last Modified","上傳時戳":"Upload Time","檔案規格不符":"Specifications of the file(s) to upload do not matched","不支援的檔案":"Format of this file isn't supported by this widget"},"zh-TW":{"未命名的檔案":"未命名的檔案","上傳":"上傳","上傳中":"上傳中","尚未上傳任何檔案":"尚未上傳任何檔案","檔案大小":"檔案大小","編輯時戳":"編輯時戳","上傳時戳":"上傳時戳","檔案規格不符":"欲上傳的檔案不符規格","不支援的檔案":"欄位不支援此檔案格式"}},dependencies:[{url:"https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js",async:false},{url:"https://cdn.jsdelivr.net/npm/moment-timezone@0.5.34/builds/moment-timezone-with-data.min.js"}]},ext:function(e){return import$(this._ext,e)},init:function(e){this._ext={};return e.pubsub.fire("subinit",{mod:mod(e,this._ext)})}};mod=function(e,d){var n,t,i,r,o,s,u,c,m,p;n=e.root,t=e.ctx,i=e.data,r=e.parent,o=e.pubsub,s=e.t,u=e.i18n;c=t.ldview,m=t.moment;p={uploading:false};return{init:function(){var u,l,r,f,a=this;u=function(e,n){p.uploading=e;p.percent=n;return f.render(["file-uploading","no-file"])};this.on("change",function(e){p.file=e;a.mod.child.view.render(["file-info","no-file"]);if(a.mod.child.view){a.mod.child.view.render()}if(d.view){d.view.setCtx(p);return d.view.render()}});l=function(e){return u(true,e.percent)};r=function(e){e==null&&(e="");return e.replace(/[/\\?%*:|"<>]/g,"").replace(/\.+/g,".").replace(/^(\.+)/,"").substring(0,100)};return this.mod.child.view=f=new c({root:n,action:{change:{input:function(e){var o,n;o=e.node;if(!a.mod.child._upload){return}return n=Promise.all(Array.from(o.files).map(function(e){if(!d.isSupported){return{supported:true}}else{return d.isSupported(e)}})).then(function(t){var e,n;if(!t.filter(function(e){return!e.supported}).length){return}e=Array.from(o.files).filter(function(e,n){return!t[n].supported}).map(function(e,n){return e.name+": "+(t[n].message||s("not supported"))}).join("\n");e=s("檔案規格不符")+":\n"+e;return Promise.reject((n=new Error,n.name="lderror",n.id=1020,n.message=e||"",n))}).then(function(){var e,i;e=function(){var e,n,t=[];for(e=0,n=o.files.length;e<n;++e){i=e;t.push(o.files[i])}return t}().map(function(e){return e={size:e.size,filename:e.name,blob:e}});return(d.detail?d.detail(e):Promise.resolve(e)).then(function(t){var e;e=t.map(function(n){var t,e;t=a._meta.term||[];e=t.map(function(e){if(/count/.exec(e.op.id)){return Promise.resolve(true)}return e.validate(n)});return Promise.all(e).then(function(e){return e.map(function(e,n){return[s(t[n].msg||"檔案規格不符"),e]}).filter(function(e){return!e[1]}).map(function(e){return e[0]}).join("; ")})});return Promise.all(e).then(function(e){return e.map(function(e,n){return[t[n].filename+": "+e,e]}).filter(function(e){return e[1]}).map(function(e){return e[0]}).join("\n")})})}).then(function(e){var n,t,i,r;if(e){e=s("檔案規格不符")+":\n"+e;return Promise.reject((n=new Error,n.name="lderror",n.id=1020,n.message=e,n))}t=f.get("button");t.classList.toggle("running",true);i=!a.mod.info.config.multiple?[(o.files||[])[0]].filter(function(e){return e}):o.files||[];r=function(n){var t;t=i[n];if(!t){return Promise.resolve()}u(true,0);return a.mod.child._upload({file:t,progress:l}).then(function(e){var n;e=[(n=import$({},e),n.blob=t,n.uploadtime=(new Date).getTime(),n)];if(d.detail){return d.detail(e)}else{return Promise.resolve(e)}}).then(function(e){e=e[0];delete e.blob;if(!p.file){p.file=[]}else if(!Array.isArray(p.file)){p.file=[p.file]}p.file.push(e);return r(n+1)})};return r(0)["finally"](function(){o.value=null;t.classList.toggle("running",false);return u(false,1)}).then(function(){var e;if(!a.mod.info.config.multiple){p.file=(e=p.file)[e.length-1]}return a.value(p.file)}).then(function(){return f.render(["file-info","no-file"])})["catch"](function(e){a.fire("upload-failed",e);return Promise.reject(e)})})["catch"](function(e){var n;o.value=null;if(lderror.id(e)!==1020){throw e}alert((n=e.message)?n:s("檔案規格不符"));return console.log(e)})}}},handler:{"file-uploading":function(e){var n;n=e.node;n.classList.toggle("d-none",!p.uploading);return n.innerText=s("上傳中")+" / "+Math.floor((p.percent||0)*1e4)/100+"%"},"no-file":function(e){var n,t;n=e.node;t=!(Array.isArray(p.file)?p.file.filter(function(e){return e}).length:!!p.file);return n.classList.toggle("d-none",!t||p.uploading)},"file-info":{list:function(){var e;e=Array.isArray(p.file)?p.file:p.file?[p.file]:[];return e.filter(function(e){return e})},view:{action:{click:{showtime:function(e){var n,t,i;n=e.node,t=e.ctx;i=!n.classList.contains("manual");n.classList.toggle("manual",i);return n.classList.toggle("tip-on",i)},delete:function(e){var n;n=e.ctx;if(!!a.mod.info.meta.readonly){return}return Promise.resolve().then(function(){var e;if(!Array.isArray(p.file)){return a.value(p.file=null)}if(!~(e=p.file.indexOf(n))){return}p.file.splice(e,1);return a.value(p.file)}).then(function(){return f.render(["file-info","no-file"])})}}},text:{filemodifiedtime:function(e){var n,t;n=e.node,t=e.ctx;return m(t.modifiedtime).tz("Asia/Taipei").format("YYYY-MM-DD HH:mm:ss")},uploadtime:function(e){var n,t;n=e.node,t=e.ctx;return m(t.uploadtime).tz("Asia/Taipei").format("YYYY-MM-DD HH:mm:ss")},"filemodifiedtime-tz":function(e){var n,t;n=e.node,t=e.ctx;return m(t.modifiedtime).tz("Asia/Taipei").format("Z")},"uploadtime-tz":function(e){var n,t;n=e.node,t=e.ctx;return m(t.uploadtime).tz("Asia/Taipei").format("Z")}},handler:{delete:function(e){var n;n=e.node;return n.classList.toggle("d-none",!!a.mod.info.meta.readonly)},size:function(e){var n,t,i;n=e.node,t=e.ctx;i=t.size||0;i=i<1024?i+"bytes":i<1048576?(i/1024).toFixed(2)+"KB":i<1024*1024*1024?(i/1048576).toFixed(2)+"MB":(i/(1024*1024*1024)).toFixed(2)+"GB";return n.innerText=i},"has-uploadtime":function(e){var n,t;n=e.node,t=e.ctx;return n.classList.toggle("d-none",!t.uploadtime)},filename:function(e){var n,t,i;n=e.node,t=e.ctx;if(!t){n.innerText=s("尚未上傳任何檔案")}i=t.filename||s("未命名的檔案");if(i.length>40){i=i.substring(0,40)+"..."}return n.innerText=i},detail:function(e){var n,t,i;n=e.node,t=e.ctx;if(t){i=r(t.filename);n.setAttribute("href",t.url)}else{n.removeAttribute("href")}return n.classList.toggle("text-danger",!t)}}}},input:function(e){var n,t,i;n=e.node;if(!a.mod.child._upload||!!a.mod.info.meta.readonly){n.setAttribute("disabled",true)}else{n.removeAttribute("disabled")}if(a.mod.info.config.multiple){n.setAttribute("multiple","multiple")}else{n.removeAttribute("multiple")}t=(a.mod.info.meta.term||[]).filter(function(e){return e.opset==="file"&&e.op==="extension"})[0];if(t){i=(t.config.str||"").split(",").filter(function(e){return e.length}).map(function(e){return"."+e}).join(",");return n.setAttribute("accept",i)}else{return n.removeAttribute("accept")}},button:function(e){var n,t;n=e.node;t=!a.mod.child._upload||!!a.mod.info.meta.readonly;return n.classList.toggle("disabled",t)}}})},render:function(){if(d.render){d.render.apply(this)}if(this.mod.child.view){this.mod.child.view.render()}if(d.view){return d.view.render()}},adapt:function(e){this.mod.child._upload=e.upload;return this.render()},isEmpty:function(e){if(typeof e==="undefined"){return true}if(Array.isArray(e)){return e.length===0}return!e}}};function import$(e,n){var t={}.hasOwnProperty;for(var i in n)if(t.call(n,i))e[i]=n[i];return e}</script><div plug="body"><div class="d-flex align-items-start mb-2 flex-wrap g-2"><div class="m-edit btn btn-primary btn-upload px-2 ld-ext-right" ld="button"><span t>上傳</span><input type="file" ld="input"><div class="ld ld-spin ld-spinner"></div></div><div class="d-flex flex-column align-items-start" style="flex:1000 0 auto;max-width:100%;width:fit-content;min-width:min(20em,100%)"><div class="d-flex flex-column g-2" style="transform:translate(0,-.1875em)"><div class="d-flex g-1 align-items-center" ld-each="file-info"><!-- use margin instead of padding to make it harder to be accidentally clicked--><i class="m-edit i-trashcan text-danger text-sm clickable m-2" ld="delete"></i><div class="text-left"><a ld="detail" rel="noopener noreferrer" target="_blank"><div ld="filename">...</div></a><div class="d-flex flex-wrap" style="font-size:12px"><div><span class="mr-1" t>檔案大小</span><span ld="size"></span></div><div class="mx-2">/</div><div class="has-tips clickable dropdown-toggle" ld="showtime"><span t>編輯時戳</span><div class="hover-tip tip-fit bottom py-1"><span class="mr-1" ld="filemodifiedtime"></span><span class="text-sm" ld="filemodifiedtime-tz" style="opacity:0.8"></span></div></div><div class="d-flex" ld="has-uploadtime"><div class="mx-2">/</div><div class="has-tips clickable dropdown-toggle" ld="showtime"><span t>上傳時戳</span><div class="hover-tip tip-fit bottom py-1"><span class="mr-1" ld="uploadtime"></span><span class="text-sm" ld="uploadtime-tz" style="opacity:0.8"></span></div></div></div></div></div></div></div><div class="text-secondary btn" t ld="no-file">尚未上傳任何檔案</div><div class="text-danger btn d-none pl-4 text-left" t ld="file-uploading"></div></div></div><plug name="preview"></plug><div class="text-danger m-edit mb-2" ld="error-root"><div ld-each="error"><i class="i-exclamation-circle"></i> <span ld="text"></span></div></div></div></div>
